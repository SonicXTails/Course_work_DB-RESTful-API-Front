{% load static %}
<!DOCTYPE html>
<html lang="ru" data-bs-theme="dark" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="dark light">
  <title>{% block title %}–ú–æ–π —Å–∞–π—Ç{% endblock %}</title>

  <link rel="icon" type="image/svg+xml" href="{% static 'css/logo.svg' %}">
  <link rel="icon" type="image/png" sizes="16x16" href="{% static 'img/favicon.png' %}"/>

  <meta name="server-theme" content="{{ THEME|default:'dark' }}">

  <script>
    (function () {
      try {
        var ls = null, server = null;
        try { ls = localStorage.getItem('THEME_OVERRIDE'); } catch(e) {}
        try {
          var m = document.querySelector('meta[name="server-theme"]');
          server = m ? m.getAttribute('content') : null;
        } catch(e) {}

        var osDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        var next = (ls === 'dark' || ls === 'light') ? ls
                 : (server === 'dark' || server === 'light') ? server
                 : (osDark ? 'dark' : 'light');

        document.documentElement.setAttribute('data-bs-theme', next);
        document.documentElement.setAttribute('data-theme', next);
      } catch (e) {}
    })();
  </script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous">

  <link rel="stylesheet" href="{% static 'css/brand.css' %}">
  <link rel="preload" href="{% static 'js/hotkeys.js' %}" as="script">

  <style>
    html, body { height: 100%; }
    body { min-height: 100vh; display: flex; flex-direction: column; }
    main { flex: 1 0 auto; }
    footer { margin-top: auto; }
  </style>

  {% if request.user.is_authenticated %}
    <meta name="is-staff" content="{% if request.user.is_staff %}1{% else %}0{% endif %}">
    <meta name="is-super" content="{% if request.user.is_superuser %}1{% else %}0{% endif %}">
    <meta name="user-groups" content="{% for g in request.user.groups.all %}{{ g.name|lower }}{% if not forloop.last %},{% endif %}{% endfor %}">
  {% endif %}
  {% if request.session.api_token %}
    <meta name="api-token" content="{{ request.session.api_token }}">
  {% endif %}
</head>
<body class="bg-body">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow">
    <div class="container">

      {% if request.session.api_token %}
        {% if request.session.is_admin or request.session.is_staff or request.session.is_super or request.user.is_staff or request.user.is_superuser %}
          <span class="navbar-brand fw-bold d-flex align-items-center gap-2">
            <img src="{% static 'css/logo.svg' %}" alt="Logo" width="28" height="28">
            <span>HaifAvto</span>
          </span>
        {% else %}
          {% with roles=request.session.roles|default_if_none:'' %}
            {% if roles %}
              {% if 'Admin' in roles or 'Administrator' in roles or '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' in roles or 'Analyst' in roles or 'Analitic' in roles or '–ê–Ω–∞–ª–∏—Ç–∏–∫' in roles %}
                <span class="navbar-brand fw-bold d-flex align-items-center gap-2">
                  <img src="{% static 'css/logo.svg' %}" alt="Logo" width="28" height="28">
                  <span>HaifAvto</span>
                </span>
              {% else %}
                <a class="navbar-brand fw-bold d-flex align-items-center gap-2" href="{% url 'users_dashboard' %}">
                  <img src="{% static 'css/logo.svg' %}" alt="Logo" width="28" height="28">
                  <span>HaifAvto</span>
                </a>
              {% endif %}
            {% else %}
              <a class="navbar-brand fw-bold d-flex align-items-center gap-2" href="{% url 'users_dashboard' %}">
                <img src="{% static 'css/logo.svg' %}" alt="Logo" width="28" height="28">
                <span>HaifAvto</span>
              </a>
            {% endif %}
          {% endwith %}
        {% endif %}
      {% else %}
        <a class="navbar-brand fw-bold d-flex align-items-center gap-2" href="{% url 'users_dashboard' %}">
          <img src="{% static 'css/logo.svg' %}" alt="Logo" width="28" height="28">
          <span>HaifAvto</span>
        </a>
      {% endif %}

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarNav" aria-controls="navbarNav"
              aria-expanded="false" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –º–µ–Ω—é">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto align-items-lg-center">

          {% if request.session.api_token %}
            {% if request.session.is_admin or request.session.is_staff or request.session.is_super or request.user.is_staff or request.user.is_superuser %}
              <li class="nav-item">
                <a href="{% url 'logout' %}" class="btn btn-outline-danger btn-sm">–í—ã–π—Ç–∏ ‚ùå</a>
              </li>
            {% else %}
              {% with roles=request.session.roles|default_if_none:'' %}
                {% if roles %}
                  {% if 'Admin' in roles or 'Administrator' in roles or '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' in roles or 'Analyst' in roles or 'Analitic' in roles or '–ê–Ω–∞–ª–∏—Ç–∏–∫' in roles %}
                    <li class="nav-item">
                      <a href="{% url 'logout' %}" class="btn btn-outline-danger btn-sm">–í—ã–π—Ç–∏ ‚ùå</a>
                    </li>
                  {% else %}
                    <li class="nav-item me-2">
                      <button id="themeToggle" class="btn btn-outline-light btn-sm" type="button">–¢–µ–º–∞</button>
                    </li>
                    <li class="nav-item me-2">
                      {% if not request.session.is_admin and not request.session.is_analitic %}
                        <a class="btn btn-outline-light btn-sm" href="{% url 'orders' %}">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</a>
                      {% endif %}
                    </li>
                    <li class="nav-item me-2">
                      <a href="{% url 'profile' %}" class="btn btn-outline-light btn-sm">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç üíº</a>
                    </li>
                    <li class="nav-item">
                      <a href="{% url 'logout' %}" class="btn btn-outline-danger btn-sm">–í—ã–π—Ç–∏ ‚ùå</a>
                    </li>
                  {% endif %}
                {% else %}
                  <li class="nav-item me-2">
                    <button id="themeToggle" class="btn btn-outline-light btn-sm" type="button">–¢–µ–º–∞</button>
                  </li>
                  <li class="nav-item me-2">
                    <a id="myOrdersLink" href="{% url 'orders' %}" class="btn btn-outline-light btn-sm">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</a>
                  </li>
                  <li class="nav-item me-2">
                    <a href="{% url 'profile' %}" class="btn btn-outline-light btn-sm">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç üíº</a>
                  </li>
                  <li class="nav-item">
                    <a href="{% url 'logout' %}" class="btn btn-outline-danger btn-sm">–í—ã–π—Ç–∏ ‚ùå</a>
                  </li>
                {% endif %}
              {% endwith %}
            {% endif %}
          {% else %}
            <li class="nav-item">
              <a href="{% url 'auth' %}" class="btn btn-outline-light btn-sm">–í–æ–π—Ç–∏ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            </li>
          {% endif %}

        </ul>
      </div>
    </div>
  </nav>

  {% if messages %}
    <div class="container mt-3" style="max-width:1200px;">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} mb-2" role="alert">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  <main class="container my-4">
    {% block content %}{% endblock %}
  </main>

<footer class="footer bg-dark text-light pt-5 pb-4 border-top border-secondary mt-5">
  <div class="container">

    <div class="row g-4">
      <div class="col-12 col-md-4">
        {% if request.session.api_token %}
          {% if request.session.is_admin or request.session.is_staff or request.session.is_super or request.user.is_staff or request.user.is_superuser %}
            <span class="d-inline-flex align-items-center mb-2 text-decoration-none text-light">
              <img src="{% static 'css/logo.svg' %}" width="32" height="32" class="me-2" alt="–õ–æ–≥–æ—Ç–∏–ø">
              <strong>HaifAvto</strong>
            </span>
          {% else %}
            {% with roles=request.session.roles|default_if_none:'' %}
              {% if roles %}
                {% if 'Admin' in roles or 'Administrator' in roles or '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' in roles or 'Analyst' in roles or 'Analitic' in roles or '–ê–Ω–∞–ª–∏—Ç–∏–∫' in roles %}
                  <span class="d-inline-flex align-items-center mb-2 text-decoration-none text-light">
                    <img src="{% static 'css/logo.svg' %}" width="32" height="32" class="me-2" alt="–õ–æ–≥–æ—Ç–∏–ø">
                    <strong>HaifAvto</strong>
                  </span>
                {% else %}
                  <a class="d-inline-flex align-items-center mb-2 text-decoration-none text-light" href="{% url 'users_dashboard' %}">
                    <img src="{% static 'css/logo.svg' %}" width="32" height="32" class="me-2" alt="–õ–æ–≥–æ—Ç–∏–ø">
                    <strong>HaifAvto</strong>
                  </a>
                {% endif %}
              {% else %}
                <a class="d-inline-flex align-items-center mb-2 text-decoration-none text-light" href="{% url 'users_dashboard' %}">
                  <img src="{% static 'css/logo.svg' %}" width="32" height="32" class="me-2" alt="–õ–æ–≥–æ—Ç–∏–ø">
                  <strong>HaifAvto</strong>
                </a>
              {% endif %}
            {% endwith %}
          {% endif %}
        {% else %}
          <a class="d-inline-flex align-items-center mb-2 text-decoration-none text-light" href="{% url 'users_dashboard' %}">
            <img src="{% static 'css/logo.svg' %}" width="32" height="32" class="me-2" alt="–õ–æ–≥–æ—Ç–∏–ø">
            <strong>HaifAvto</strong>
          </a>
        {% endif %}

        <p class="text-secondary small mb-3">
          –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø—Ä–æ–¥–∞–∂–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π. –û–±—ä—è–≤–ª–µ–Ω–∏—è, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞.
        </p>

        <ul class="list-unstyled d-flex gap-2 mb-0">
          <li>
            <a class="social-link" href="https://t.me/" target="_blank" rel="noopener" aria-label="Telegram">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M9.04 15.23 8.9 19.1c.32 0 .46-.14.62-.31l1.49-1.43 3.09 2.27c.57.31.98.15 1.13-.53l2.05-9.63c.18-.82-.31-1.14-.86-.94L4.6 11.06c-.82.32-.8.78-.14.99l3.61 1.13 8.37-5.29c.39-.24.74-.11.45.15"/></svg>
            </a>
          </li>
          <li>
            <a class="social-link" href="https://vk.com/" target="_blank" rel="noopener" aria-label="VK">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 7c.11 4.3 2.27 8.06 6.06 10.98h2.12v-3.85c1.02.1 1.8.87 2.86 1.96 1.12 1.17 1.96 1.89 3.2 1.89h2.2v-2.46c-1.46-.15-2.27-1.2-3.2-2.3-.63-.74-.22-1.08.51-2.07.72-.97 1.27-2 1.27-2.96 0-1.23-.85-2.19-2.7-2.19-1.04 0-1.86.24-2.42.76-.56.51-.74 1.19-.74 2.01v.78H10.7c.03-2.04.06-3.97.06-3.97H8.7C6.24 4.58 2.89 5.45 3 7z"/></svg>
            </a>
          </li>
          <li>
            <a class="social-link" href="https://youtube.com" target="_blank" rel="noopener" aria-label="YouTube">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M23.5 7.5s-.23-1.66-.95-2.39c-.91-.95-1.93-.96-2.4-1C16.9 3.75 12 3.75 12 3.75h0s-4.9 0-8.15.36c-.47.04-1.49.05-2.4 1C.73 5.84.5 7.5.5 7.5S.25 9.43.25 11.35v1.3c0 1.93.25 3.85.25 3.85s.23 1.66.95 2.39c.91.95 2.11.92 2.64 1.02 1.92.18 8 .36 8 .36s4.9 0 8.15-.36c.47-.04 1.49-.05 2.4-1 .72-.73.95-2.39.95-2.39s.25-1.93.25-3.85v-1.3c0-1.92-.25-3.85-.25-3.85zM9.75 14.9V8.8l6.05 3.06-6.05 3.04z"/></svg>
            </a>
          </li>
          <li>
            <a class="social-link" href="https://instagram.com" target="_blank" rel="noopener" aria-label="Instagram">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 7.3A4.7 4.7 0 1 0 12 16.7 4.7 4.7 0 0 0 12 7.3zm0-5.3c2.6 0 2.9 0 3.9.06 1 .06 1.7.22 2.3.47.6.23 1.2.56 1.7 1.06.5.5.83 1.1 1.06 1.7.25.6.4 1.3.47 2.3.06 1 .06 1.3.06 3.9s0 2.9-.06 3.9c-.06 1-.22 1.7-.47 2.3-.23.6-.56 1.2-1.06 1.7-.5.5-1.1.83-1.7 1.06-.6.25-1.3.4-2.3.47-1 .06-1.3.06-3.9.06s-2.9 0-3.9-.06c-1-.06-1.7-.22-2.3-.47-.6-.23-1.2-.56-1.7-1.06-.5-.5-.83-1.1-1.06-1.7-.25-.6-.4-1.3-.47-2.3C2 14.9 2 14.6 2 12s0-2.9.06-3.9c.06-1 .22-1.7.47-2.3.23-.6.56-1.2 1.06-1.7.5-.5 1.1-.83 1.7-1.06.6-.25 1.3-.4 2.3-.47C9.1 2 9.4 2 12 2zM12 8.9A3.1 3.1 0 1 1 8.9 12 3.1 3.1 0 0 1 12 8.9zm5.1-2.3a.9.9 0 1 0 .9.9.9.9 0 0 0-.9-.9z"/></svg>
            </a>
          </li>
          <li>
            <a class="social-link" href="https://github.com/SonicXTails/Course_work_DB-RESTful-API-Front/commits/main/" target="_blank" rel="noopener" aria-label="GitHub">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 .5A11.5 11.5 0 0 0 .5 12c0 5.09 3.29 9.4 7.86 10.92.58.11.79-.25.79-.56v-2c-3.2.7-3.87-1.37-3.87-1.37-.53-1.36-1.3-1.72-1.3-1.72-1.06-.73.08-.72.08-.72 1.17.08 1.78 1.2 1.78 1.2 1.04 1.78 2.74 1.26 3.4.96.1-.76.4-1.26.73-1.55-2.55-.29-5.24-1.28-5.24-5.69 0-1.26.45-2.29 1.2-3.09-.12-.29-.52-1.45.11-3.02 0 0 .97-.31 3.18 1.18a11.1 11.1 0 0 1 5.8 0C17.6 4.08 18.57 4.4 18.57 4.4c.63 1.57.24 2.73.12 3.02.75.8 1.2 1.83 1.2 3.09 0 4.42-2.7 5.39-5.26 5.68.41.35.78 1.04.78 2.1v3.11c0 .3.2.67.8.56A11.5 11.5 0 0 0 23.5 12 11.5 11.5 0 0 0 12 .5z"/></svg>
            </a>
          </li>
        </ul>
      </div>

      <div class="col-6 col-md-2">
        <h6 class="text-uppercase text-secondary small mb-3">–ö–æ–º–ø–∞–Ω–∏—è</h6>
        <ul class="list-unstyled mb-0">
          <li><a class="footer-link" href="#">–û –Ω–∞—Å</a></li>
          <li><a class="footer-link" href="#">–ù–æ–≤–æ—Å—Ç–∏</a></li>
          <li><a class="footer-link" href="#">–í–∞–∫–∞–Ω—Å–∏–∏</a></li>
          <li><a class="footer-link" href="#">–ü–∞—Ä—Ç–Ω—ë—Ä–∞–º</a></li>
        </ul>
      </div>

      <div class="col-6 col-md-2">
        <h6 class="text-uppercase text-secondary small mb-3">–ü–æ–∫—É–ø–∞—Ç–µ–ª—è–º</h6>
        <ul class="list-unstyled mb-0">
          <li><a class="footer-link" href="#">–ö–∞—Ç–∞–ª–æ–≥ –∞–≤—Ç–æ</a></li>
          <li><a class="footer-link" href="#">–ö–∞–∫ –∫—É–ø–∏—Ç—å</a></li>
          <li><a class="footer-link" href="#">–û–ø–ª–∞—Ç–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç</a></li>
          <li><a class="footer-link" href="#">FAQ</a></li>
        </ul>
      </div>

      <div class="col-12 col-md-4">
        <h6 class="text-uppercase text-secondary small mb-3">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h6>
        <ul class="list-unstyled small mb-3">
          <li class="mb-1"><span class="me-2">üìç</span> –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 7</li>
          <li class="mb-1"><span class="me-2">üìû</span> <a class="footer-link" href="tel:+74951234567">+7 (495) 123-45-67</a></li>
          <li class="mb-1"><span class="me-2">‚úâÔ∏è</span> <a class="footer-link" href="mailto:info@haifavto.ru">info@haifavto.ru</a></li>
          <li class="text-secondary">–ü–Ω‚Äì–ü—Ç 10:00‚Äì19:00, –°–±‚Äì–í—Å 11:00‚Äì17:00</li>
        </ul>

        <form class="mt-2" action="#" method="post" novalidate>
          <label class="form-label small text-secondary">–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –Ω–æ–≤–æ—Å—Ç–∏</label>
          <div class="input-group input-group-sm">
            <input type="email" class="form-control bg-dark text-light border-secondary"
                   placeholder="–í–∞—à email" aria-label="Email">
            <button class="btn btn-outline-light" type="submit">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</button>
          </div>
          <div class="form-text text-secondary">–†–∞–∑ –≤ –º–µ—Å—è—Ü, –±–µ–∑ —Å–ø–∞–º–∞. –ú–æ–∂–Ω–æ –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.</div>
        </form>
      </div>
    </div>

    <hr class="border-secondary my-4">

    <div class="d-flex flex-column flex-md-row align-items-center justify-content-between gap-2 small">
      <div>&copy; <span id="footerYear"></span> HaifAvto. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</div>
      <ul class="nav gap-2">
        <li class="nav-item"><a class="nav-link p-0 footer-link" href="#">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ</a></li>
        <li class="nav-item"><a class="nav-link p-0 footer-link" href="#">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a></li>
        <li class="nav-item"><a class="nav-link p-0 footer-link" href="#">–§–∞–π–ª—ã cookie</a></li>
      </ul>
      <div class="d-flex align-items-center gap-2">
        <span class="pay-badge">VISA</span>
        <span class="pay-badge">Mastercard</span>
        <span class="pay-badge">–ú–ò–†</span>
      </div>
    </div>
  </div>
</footer>

<script>
  (function(){ var el=document.getElementById('footerYear'); if(el){ el.textContent=new Date().getFullYear(); }})();
</script>

<style>
  .footer a.footer-link{ color: rgba(255,255,255,.85); text-decoration: none; }
  .footer a.footer-link:hover{ color: #fff; text-decoration: underline; }
  .footer h6{ letter-spacing:.08em; }
  .footer .social-link{
    display:inline-flex; align-items:center; justify-content:center;
    width:36px; height:36px; border-radius:.5rem;
    border:1px solid rgba(255,255,255,.25); color:#fff; transition:.15s ease;
  }
  .footer .social-link:hover{ background:rgba(255,255,255,.1); border-color:rgba(255,255,255,.5); transform:translateY(-1px); }
  .footer .social-link svg{ width:18px; height:18px; fill:currentColor; }
  .footer .pay-badge{ display:inline-block; padding:.25rem .5rem; border-radius:.35rem; border:1px solid rgba(255,255,255,.25); color:#fff; font-weight:600; font-size:.75rem; background:rgba(255,255,255,.06); }
</style>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

  <script>
    // –ï–î–ò–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –¢–ï–ú–´ + Alt+8 + —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º
    (function(){
      const API_BASE = "http://127.0.0.1:8000/api/v1";
      const TOKEN = document.querySelector('meta[name="api-token"]')?.getAttribute('content') || "";

      function setThemeAttr(next) {
        document.documentElement.setAttribute('data-bs-theme', next);
        document.documentElement.setAttribute('data-theme', next);
        try { localStorage.setItem('THEME_OVERRIDE', next); } catch(e) {}
      }

      async function saveThemeServer(next) {
        if (!TOKEN) return;
        try {
          await fetch(API_BASE + "/users/me/theme/", {
            method: "PATCH",
            headers: {
              "Authorization": "Token " + TOKEN,
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ theme: next })
          });
        } catch(e) {}
      }

      // –ü—É–±–ª–∏—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (–∫–Ω–æ–ø–∫–∞/–≥–æ—Ä—è—á–∞—è –∫–ª–∞–≤–∏—à–∞)
      window.toggleTheme = async function(next) {
        const current = document.documentElement.getAttribute('data-bs-theme') || 'dark';
        const target = (next === 'dark' || next === 'light') ? next : (current === 'light' ? 'dark' : 'light');
        setThemeAttr(target);
        await saveThemeServer(target);
      };

      // –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –∫–Ω–æ–ø–∫–µ –≤ —à–∞–ø–∫–µ
      const btn = document.getElementById('themeToggle');
      if (btn) btn.addEventListener('click', function(){ window.toggleTheme(); });

      // –ì–æ—Ä—è—á–∞—è –∫–ª–∞–≤–∏—à–∞: Alt + 8
      document.addEventListener('keydown', function(e){
        const tag = (e.target && e.target.tagName) ? e.target.tagName.toUpperCase() : "";
        const typing = tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT' || (e.target && e.target.isContentEditable);
        if (typing) return;
        if (e.altKey && !e.ctrlKey && !e.metaKey && (e.key === '8' || e.code === 'Digit8' || e.code === 'Numpad8')) {
          e.preventDefault();
          window.toggleTheme();
        }
      });

      // NEW: –ü–æ–¥—Ç—è–Ω—É—Ç—å —Ç–µ–º—É –∏–∑ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage
      // —á—Ç–æ–±—ã –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞—Ö–æ–¥–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –ø–µ—Ä–≤–æ–≥–æ –∫–∞–¥—Ä–∞ –±—ã–ª–∞ ¬´–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π¬ª.
      if (TOKEN) {
        try {
          fetch(API_BASE + "/users/me/theme/", {
            headers: { "Authorization": "Token " + TOKEN }
          })
          .then(r => r.ok ? r.json() : null)
          .then(j => {
            if (j && (j.theme === 'dark' || j.theme === 'light')) {
              setThemeAttr(j.theme);
            }
          })
          .catch(()=>{});
        } catch(e) {}
      }
    })();
  </script>

  <script src="{% static 'js/hotkeys.js' %}"></script>
</body>
</html>